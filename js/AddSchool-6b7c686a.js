import{m as u}from"./vendor-54a376b9.js";import{_ as m,u as d,f as r,V}from"./common-e61c72ea.js";const p={name:"AddSchool",setup(){return{baseStore:d()}},data(){return{mitt:Vue.inject("mitt"),localSchool:this.$clone(this.baseStore.userinfo.school),educationList:[{id:1,name:"专科"},{id:2,name:"本科"},{id:3,name:"硕士"},{id:4,name:"博士"}]}},created(){let e=localStorage.getItem("changeSchool"),t=localStorage.getItem("changeDepartment"),c=localStorage.getItem("changeDisplayType"),n=localStorage.getItem("changeJoinTime"),l=localStorage.getItem("changeEducation");e!==null&&(this.localSchool.name=e),t!==null&&(this.localSchool.department=t),c!==null&&(this.localSchool.displayType=~~c),n!==null&&(this.localSchool.joinTime=~~n),l!==null&&(this.localSchool.education=l)},computed:{...u(d,["userinfo"]),isChanged(){return this.school.name!==this.localSchool.name||this.school.department!==this.localSchool.department||this.school.joinTime!==this.localSchool.joinTime||this.school.education!==this.localSchool.education?!0:this.school.displayType!==this.localSchool.displayType},displayType(){if(this.localSchool.displayType===r.DISPLAY_TYPE.ALL)return"公开可见";if(this.localSchool.displayType===r.DISPLAY_TYPE.SCHOOL)return"校友可见";if(this.localSchool.displayType===r.DISPLAY_TYPE.ME)return"仅自己可见"},school(){return this.userinfo.school}},methods:{showJoinTimeDialog(){new V({trigger:"#trigger1",title:"学历",wheels:[{data:Array.apply(null,{length:50}).map((e,t)=>new Date().getFullYear()-t)}],callback:(e,t)=>{localStorage.setItem("changeJoinTime",t[0]),this.localSchool.joinTime=~~t[0]}}).show()},showEducationDialog(){this.$showSelectDialog(this.educationList,e=>{localStorage.setItem("changeEducation",e.name),this.localSchool.education=e.name})},isEmpty(e){return e||"点击设置"},checkGo(e){if(!this.localSchool.name)return this.$notice("请先选择学校 ");this.$nav(e)},back(){this.isChanged?this.$showSimpleConfirmDialog("学校信息30天内只允许修改一次，是否保存修改",this.save,()=>{localStorage.clear(),this.$back()}):(localStorage.clear(),this.$back())},async save(){if(!this.isChanged)return;this.$showLoading();let e={...this.userinfo,school:this.localSchool};this.baseStore.setUserinfo(e),await this.$sleep(500),this.$hideLoading(),localStorage.clear(),this.$back(),this.$notice("修改成功")}}},a=e=>(Vue.pushScopeId("data-v-2f3661c1"),e=e(),Vue.popScopeId(),e),g={class:"school"},S=a(()=>Vue.createElementVNode("span",{class:"f16"},"添加学校",-1)),y={class:"content"},_=a(()=>Vue.createElementVNode("div",{class:"left"},"学校",-1)),f={class:"right"},E=a(()=>Vue.createElementVNode("div",{class:"left"},"院系",-1)),v={class:"right"},N=a(()=>Vue.createElementVNode("div",{class:"left"},"入学时间",-1)),T={class:"right"},w={id:"trigger1"},k=a(()=>Vue.createElementVNode("div",{class:"left"},"学历",-1)),D={class:"right"},C=a(()=>Vue.createElementVNode("div",{class:"left"},"展示范围",-1)),I={class:"right"};function b(e,t,c,n,l,o){const h=Vue.resolveComponent("BaseHeader"),s=Vue.resolveComponent("dy-back");return Vue.openBlock(),Vue.createElementBlock("div",g,[Vue.createVNode(h,{onBack:o.back},{center:Vue.withCtx(()=>[S]),right:Vue.withCtx(()=>[Vue.createElementVNode("div",null,[Vue.createElementVNode("span",{class:Vue.normalizeClass(["f16",o.isChanged?"save-yes":"save-no"]),onClick:t[0]||(t[0]=(...i)=>o.save&&o.save(...i))},"保存",2)])]),_:1},8,["onBack"]),Vue.createElementVNode("div",y,[Vue.createElementVNode("div",{class:"row",onClick:t[1]||(t[1]=i=>e.$nav("/me/choose-school"))},[_,Vue.createElementVNode("div",f,[Vue.createElementVNode("span",null,Vue.toDisplayString(o.isEmpty(l.localSchool.name)),1),Vue.createVNode(s,{scale:"1",direction:"right"})])]),Vue.createElementVNode("div",{class:"row",onClick:t[2]||(t[2]=i=>o.checkGo("/me/choose-department"))},[E,Vue.createElementVNode("div",v,[Vue.createElementVNode("span",null,Vue.toDisplayString(o.isEmpty(l.localSchool.department)),1),Vue.createVNode(s,{scale:"1",direction:"right"})])]),Vue.createElementVNode("div",{class:"row",onClick:t[3]||(t[3]=(...i)=>o.showJoinTimeDialog&&o.showJoinTimeDialog(...i))},[N,Vue.createElementVNode("div",T,[Vue.createElementVNode("span",null,Vue.toDisplayString(o.isEmpty(l.localSchool.joinTime)),1),Vue.createVNode(s,{scale:"1",direction:"right"}),Vue.withDirectives(Vue.createElementVNode("div",w,null,512),[[Vue.vShow,!1]])])]),Vue.createElementVNode("div",{class:"row",onClick:t[4]||(t[4]=(...i)=>o.showEducationDialog&&o.showEducationDialog(...i))},[k,Vue.createElementVNode("div",D,[Vue.createElementVNode("span",null,Vue.toDisplayString(o.isEmpty(l.localSchool.education)),1),Vue.createVNode(s,{scale:"1",direction:"right"})])]),Vue.createElementVNode("div",{class:"row",onClick:t[5]||(t[5]=i=>e.$nav("/me/display-type",{displayType:l.localSchool.displayType}))},[C,Vue.createElementVNode("div",I,[Vue.createElementVNode("span",null,Vue.toDisplayString(o.displayType),1),Vue.createVNode(s,{scale:"1",direction:"right"})])])])])}const j=m(p,[["render",b],["__scopeId","data-v-2f3661c1"]]);export{j as default};
